import{c as v}from"./cartStore-me3BoJxt.js";import{_ as L,f as k,m as w,r as p,o as i,c as d,a as e,F as g,g as q,t as m,j as b,b as n,w as B,e as V,k as E,v as T,n as h}from"./index-f2bgMWh1.js";var U={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"annchou",BASE_URL:"/vue_week6/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_API:y,VITE_PATH:x}=U,I={data(){return{form:{user:{email:"",tel:"",address:""},message:""}}},methods:{...k(v,["getCartsList","updateCart","deleteCartItem"]),submitOrder(){if(!this.cartsList.carts.length){this.$swal.fire("購物車內沒有商品");return}const o=this.$loading.show(),t=`${y}/api/${x}/order`,u={data:this.form};this.axios.post(t,u).then(r=>{this.$swal.fire(r.data.message),this.$refs.form.resetForm(),this.getCartsList()}).catch(r=>{this.$swal.fire({icon:"error",text:r.response.data.message})}).finally(()=>{o.hide()})},clearCartsList(){this.$swal.fire({title:"確定要清空購物車嗎？",icon:"question",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"OK"}).then(o=>{if(o.isConfirmed){const t=this.$loading.show(),u=`${y}/api/${x}/carts`;this.axios.delete(u).then(r=>{this.$swal.fire(r.data.message),this.getCartsList()}).catch(r=>this.$swal.fire({icon:"error",text:r.response.data.message})).finally(()=>{t.hide()})}})}},mounted(){this.getCartsList()},computed:{...w(v,["cartsList"])}},S={class:"container py-5"},A=e("h2",{class:"mb-5 text-center"},"購物車",-1),$={class:"text-end"},D=["disabled"],O={key:0,class:"text-center"},P={key:1,class:"table align-middle"},N=e("thead",null,[e("tr",null,[e("th"),e("th",null,"品名"),e("th",{style:{width:"150px"}},"數量/單位"),e("th",null,"單價")])],-1),F=["onClick"],R={key:0,class:"text-success"},j={class:"input-group input-group-sm"},H={class:"input-group mb-3"},M=["onUpdate:modelValue","onBlur"],z={class:"input-group-text",id:"basic-addon2"},K={class:"text-end"},G={key:0,class:"text-success"},J=e("td",{colspan:"3",class:"text-end"},"總計",-1),Q={class:"text-end"},W={key:0},X=e("td",{colspan:"3",class:"text-end text-success"},"折扣價",-1),Y={class:"text-end text-success"},Z={class:"py-4 bg-light"},ee={class:"container"},se={class:"my-5 row justify-content-center"},te=e("h2",{class:"text-center"},"訂購資料",-1),oe={class:"mb-3"},le=e("label",{for:"email",class:"form-label has-required"},"Email",-1),ae={class:"mb-3"},ne=e("label",{for:"name",class:"form-label has-required"},"收件人姓名",-1),re={class:"mb-3"},ie=e("label",{for:"tel",class:"form-label has-required"},"收件人電話",-1),de={class:"mb-3"},ce=e("label",{for:"address",class:"form-label has-required"},"收件人地址",-1),me={class:"mb-3"},ue=e("label",{for:"message",class:"form-label"},"留言",-1),_e=e("div",{class:"text-end"},[e("button",{type:"submit",class:"btn btn-danger"},"送出訂單")],-1);function he(o,t,u,r,a,f){const c=p("v-field"),_=p("error-message"),C=p("v-form");return i(),d(g,null,[e("div",S,[A,e("div",$,[e("button",{class:"btn btn-outline-danger",type:"button",onClick:t[0]||(t[0]=(...s)=>f.clearCartsList&&f.clearCartsList(...s)),disabled:!o.cartsList.final_total},"清空購物車",8,D)]),o.cartsList.final_total?(i(),d("table",P,[N,e("tbody",null,[(i(!0),d(g,null,q(o.cartsList.carts,s=>(i(),d("tr",{key:s.id},[e("td",null,[e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:l=>o.deleteCartItem(s.id)}," x ",8,F)]),e("td",null,[V(m(s.product.title)+" ",1),s.coupon?(i(),d("div",R," 已套用優惠券 ")):b("",!0)]),e("td",null,[e("div",j,[e("div",H,[E(e("input",{min:"1",type:"number",class:"form-control","onUpdate:modelValue":l=>s.qty=l,onBlur:l=>o.updateCart(s)},null,40,M),[[T,s.qty,void 0,{number:!0}]]),e("span",z,m(s.product.unit),1)])])]),e("td",K,[s.total!==s.final_total?(i(),d("small",G,"折扣價：")):b("",!0),V(" "+m(s.final_total),1)])]))),128))]),e("tfoot",null,[e("tr",null,[J,e("td",Q,m(o.cartsList.total),1)]),o.cartsList.total!==o.cartsList.final_total?(i(),d("tr",W,[X,e("td",Y,m(o.cartsList.final_total),1)])):b("",!0)])])):(i(),d("p",O,"目前購物車內沒有內容"))]),e("div",Z,[e("div",ee,[e("div",se,[te,n(C,{ref:"form",class:"col-md-6",onSubmit:f.submitOrder},{default:B(({errors:s})=>[e("div",oe,[le,n(c,{id:"email",name:"email",type:"email",class:h(["form-control",{"is-invalid":s.email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:a.form.user.email,"onUpdate:modelValue":t[1]||(t[1]=l=>a.form.user.email=l)},null,8,["class","modelValue"]),n(_,{name:"email",class:"invalid-feedback"})]),e("div",ae,[ne,n(c,{id:"name",name:"name",type:"text",class:h(["form-control",{"is-invalid":s.name}]),placeholder:"請輸入姓名",rules:"required",modelValue:a.form.user.name,"onUpdate:modelValue":t[2]||(t[2]=l=>a.form.user.name=l)},null,8,["class","modelValue"]),n(_,{name:"name",class:"invalid-feedback"})]),e("div",re,[ie,n(c,{id:"tel",name:"tel",type:"tel",class:h(["form-control",{"is-invalid":s.tel}]),placeholder:"請輸入電話",rules:"required|min:8|max:10",modelValue:a.form.user.tel,"onUpdate:modelValue":t[3]||(t[3]=l=>a.form.user.tel=l)},null,8,["class","modelValue"]),n(_,{name:"tel",class:"invalid-feedback"})]),e("div",de,[ce,n(c,{id:"address",name:"address",type:"text",class:h(["form-control",{"is-invalid":s.address}]),placeholder:"請輸入地址",rules:"required",modelValue:a.form.user.address,"onUpdate:modelValue":t[4]||(t[4]=l=>a.form.user.address=l)},null,8,["class","modelValue"]),n(_,{name:"address",class:"invalid-feedback"})]),e("div",me,[ue,n(c,{id:"message",name:"message",class:"form-control",cols:"30",rows:"10",modelValue:a.form.message,"onUpdate:modelValue":t[5]||(t[5]=l=>a.form.message=l),as:"textarea"},null,8,["modelValue"])]),_e]),_:1},8,["onSubmit"])])])])],64)}const be=L(I,[["render",he]]);export{be as default};
